<!-- Start Timer Widget -->

{% comment %}
	{{counter}} is a reference to the display order. It's needed so multiple 
	instances of the same widget component can be used on a single page.
	
	When the timer reaches zero, widget_timer_event_timeout is fired on the html element.
	
	This widget requires:
	<script src="/site_media/scripts/jquery/jquery.pack.js" type="text/javascript" charset="utf-8"></script>
	
	
{% endcomment %}

<script type="text/javascript" charset="utf-8">

var widget_timerTime{{counter}} = new Date();
widget_timerTime{{counter}}.setMinutes({{widgetParams.mins}});
widget_timerTime{{counter}}.setSeconds({{widgetParams.secs}});
var widget_timerElapsed{{counter}} = widget_timerTime{{counter}}.getTime();

widget_timerLoop{{counter}}();

/**
* Decrements timer. If the timer reaches zero, the "widget_timer_event_timeout"
* event is triggered and the loop stops.
* 
*/
function widget_timerLoop{{counter}}(){
	
	// Get the mins and secs and convert them to strings
	widget_timerMins{{counter}} = widget_timerTime{{counter}}.getMinutes().toString();
	widget_timerSecs{{counter}} = widget_timerTime{{counter}}.getSeconds().toString();

	// Pad seconds with a 0 if neeeded
	if(widget_timerSecs{{counter}}.length < 2){
		widget_timerSecs{{counter}} = "0" + widget_timerSecs{{counter}};
	}	

	$('#widget_timer_minutes{{counter}}').text( widget_timerMins{{counter}} );
	$('#widget_timer_seconds{{counter}}').text( widget_timerSecs{{counter}} );

	if(widget_timerMins{{counter}} == "0" && widget_timerSecs{{counter}} == "00"){
		clearTimeout(widget_timerTimeout{{counter}});
		$("html").trigger("widget_timer_event_timeout");
		return;
	}

	widget_timerElapsed{{counter}} -= 1000;
	widget_timerTime{{counter}}.setTime(widget_timerElapsed{{counter}});
	widget_timerTimeout{{counter}} = setTimeout("widget_timerLoop{{counter}}()", 1000);
	
	return;
}

</script>


<div class="widget_timer{{counter}}">
	<div class="widget_timer_text">
		Time remaining for this round
	</div>
	<div class="widget_timer_numbers">
		<span id="widget_timer_minutes{{counter}}"></span>:<span id="widget_timer_seconds{{counter}}"></span>
	</div>
</div>

<!-- End Timer Widget -->









