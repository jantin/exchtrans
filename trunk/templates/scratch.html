{% extends "adminBase.html" %}{% block extrahead %}
<script type="text/javascript" src="/site_media/scripts/jquery/jquery.pack.js"></script>
<script src="/site_media/scripts/jquery/jquery.alphanumeric.pack.js" type="text/javascript" ></script>

<style type="text/css">



</style>
<script type="text/javascript">
	$(document).ready(
		function(){
			// Bind the input fields of the offerFormulation screen
			// Updates the "This deal would get you" number on the offerFormulation screen
			$('.offerFormulationInputs').numeric();
			// $(".offerFormulationInputs").keyup(function(){
			// 	offerFormulationProcessInput();
			// });
			// $(".valueInputs").keyup(function(){
			// 	offerFormulationProcessInput();
			// });
			// $("#offerFormulationOfferUnit").change(function(){
			// 	offerFormulationProcessInput();
			// });
			// $("#offerFormulationRequestUnit").change(function(){
			// 	offerFormulationProcessInput();
			// });
			
			$('#refreshValues').bind("click", function(){
				offerFormulationProcessInput();
			});
		}
	);
	
	// Updates the "This deal would get you" number on the offerFormulation screen
	// Called on keyup of the input fields of the offerFormulation screen
	function offerFormulationProcessInput(){		
		// Clear the error if present
		$("#offerFormulationOfferError").html("");

		// Set up all our working variables
		options = {
			whichPlayer: $('#whichPlayer').val(),
			offer: $("#offerFormulationOffer").val(),
			request: $("#offerFormulationRequest").val(),
			offerUnit: $("#offerFormulationOfferUnit").val(),
			requestUnit: $("#offerFormulationRequestUnit").val(),
			p1x: $("#p1x").val(),
			p2x: $("#p2x").val(),
			p1y: $("#p1y").val(),
			p2y: $("#p2y").val(),
			p1xValue: $("#p1xValue").val(),
			p2xValue: $("#p2xValue").val(),
			p1yValue: $("#p1yValue").val(),
			p2yValue: $("#p2yValue").val()
		}
		
		if( options['whichPlayer'] == "p1"){
			xValue = parseValueInput(options['p1xValue'], options);
			yValue = parseValueInput(options['p1yValue'], options);
			availableX = options['p1x'];
			availableY = options['p1y'];
		} else {
			xValue = parseValueInput(options['p2xValue'], options);
			yValue = parseValueInput(options['p2yValue'], options);
			availableX = options['p2x'];
			availableY = options['p2y'];
		}
		
		// Calculate the current number of points held by the player this round
		initialPoints = (availableX * xValue) + (availableY * yValue);
		
		// Calculate the loss from offering
		if(options['offerUnit'] == "x"){
			// Check that the input value is not beyond the available amount
			if(parseInt(options['offer']) > parseInt(availableX)) {
				options['offer'] = availableX;
				$("#offerFormulationOffer").val(options['offer']);
				$("#offerFormulationOfferError").html("You only have " + availableX + " " + options['offerUnit']);
			}
			loss = options['offer'] * xValue;
		} else {
			// Check that the input value is not beyond the available amount
			if(parseInt(options['offer']) > parseInt(availableY)) {
				options['offer'] = availableY;
				$("#offerFormulationOffer").val(options['offer']);
				$("#offerFormulationOfferError").html("You only have " + availableY + " " + options['offerUnit']);
			}
			loss = options['offer'] * yValue;
		}
		
		// Calculate the potential gain from the request
		if(options['requestUnit'] == "x"){
			gain = options['request'] * xValue;
		} else {
			gain = options['request'] * yValue;
		}
		
		// calculate the potential points
		pointsPreview = initialPoints + (gain - loss);		
		//alert(pointsPreview);
		// Display the preview points
		$("#offerFormulationPoints").html(pointsPreview);
	}
	
	function parseValueInput(valueInput, options){
		
		//Check if input is just digits, if so return value input right away
		if(/^\d+$/.test(valueInput)){
			return valueInput;	
		}
				 
		//replace variables if present
		if(options['offerUnit'] == "x"){
			valueInput = valueInput.replace(/Ox/g, options['offer']);
			valueInput = valueInput.replace(/Oy/g, "0");
		} else {
			valueInput = valueInput.replace(/Ox/g, "0");
			valueInput = valueInput.replace(/Oy/g, options['offer']);
		}
		
		if(options['requestUnit'] == "x"){
			valueInput = valueInput.replace(/Rx/g, options['request']);
			valueInput = valueInput.replace(/Ry/g, "0");
		} else {
			valueInput = valueInput.replace(/Rx/g, "0");
			valueInput = valueInput.replace(/Ry/g, options['request']);
		}
		
		valueInput = valueInput.replace(/Ax/g, options[options['whichPlayer'] + 'x']);
		valueInput = valueInput.replace(/Ay/g, options[options['whichPlayer'] + 'y']);
		
		
		alert(eval(valueInput));
		//evaluate value expression and return it
		return eval(valueInput);
	}
</script>

{% endblock %}{% block bodyid %}tab2{% endblock %}{% block sectionDivID %}editor{% endblock %}{% block adminContent %}


<div id="valuePreview" class="valuePreviewDialog" title="Use this form to check your values" >

<h3>Starting XY Quantities</h3>
<table>
	<tr><th></th><th>Player 1</th><th>Player 2</th></tr>
	<tr>
		<th>X</th>
		<td><input type="text" name="p1x" value="10" size="4" id="p1x" class="offerFormulationInputs"/></td>
		<td><input type="text" name="p2x" value="10" size="4" id="p2x" class="offerFormulationInputs"/></td>
	</tr>
	<tr>
		<th>Y</th>
		<td><input type="text" name="p1y" value="10" size="4" id="p1y" class="offerFormulationInputs"/></td>
		<td><input type="text" name="p2y" value="10" size="4" id="p2y" class="offerFormulationInputs"/></td>
	</tr>
</table>

<h3>Offer Setup</h3>
<p>Who is the offer from?</p>
<p>
<select name="whichPlayer" id="whichPlayer">
	<option value="p1">Player 1</option>
	<option value="p2">Player 2</option>
</select>
</p>
<p>What will the player give?</p>
<p>
	<input type="text" name="offerFormulationOffer" id="offerFormulationOffer" class="offerFormulationInputs" value="0" size="4"/>
	<select name="offerFormulationOfferUnit" id="offerFormulationOfferUnit">
		<option>x</option>
		<option>y</option>
	</select>
	<span id="offerFormulationOfferError" class="offerFormulationError"></span>
</p>
<p>What does the player want in return?</p>
<p>
	<input type="text" name="offerFormulationRequest" id="offerFormulationRequest" class="offerFormulationInputs" value="0" size="4"/>
	<select name="offerFormulationRequestUnit" id="offerFormulationRequestUnit">
		<option>y</option>
		<option>x</option>
	</select>
</p>

<h3>Value Formulas</h3>
<table>
	<tr><th></th><th>Player 1</th><th>Player 2</th></tr>
	<tr>
		<th>X</th>
		<td><input type="text" name="p1xValue" value="10" size="20" id="p1xValue" class="valueInputs"/></td>
		<td><input type="text" name="p2xValue" value="10" size="20" id="p2xValue" class="valueInputs"/></td>
	</tr>
	<tr>
		<th>Y</th>
		<td><input type="text" name="p1yValue" value="10" size="20" id="p1yValue" class="valueInputs"/></td>
		<td><input type="text" name="p2yValue" value="10" size="20" id="p2yValue" class="valueInputs"/></td>
	</tr>
</table>
<p>Possible Variables:</p>
<table>
	<tr>
		<th>Variable</th>
		<th>Description</th>
	</tr>
	<tr>
		<td>Ox</td>
		<td>The number of X's offered</td>
	</tr>
	<tr>
		<td>Oy</td>
		<td>The number of Y's offered</td>
	</tr>
	<tr>
		<td>Rx</td>
		<td>The number of X's requested</td>
	</tr>
	<tr>	
		<td>Ry</td>
		<td>The number of Y's requested</td>
	</tr>
	<tr>
		<td>Ax</td>
		<td>The number of X's available to offer</td>
	</tr>
	<tr>
		<td>Ay</td>
		<td>The number of Y's available to offer</td>
	</tr>
</table>
<br/><br/>
<h3>Point Value</h3>
<table>
	<tr><th></th><th>Player 1</th><th>Player 2</th></tr>
	<tr>
		<th>Total Points</th>
		<td><span id="offerFormulationPoints">0</span></td>
		<td><span id="offerFormulationPoints">0</span></td>
	</tr>
</table>
<input type="button" name="refreshValues" value="Refresh Values" id="refreshValues">
</div>

{% endblock %}
